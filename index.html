<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Customer Recap</title>
  <meta name="theme-color" content="#0ea5e9">
  <style>
    :root{--bg:#f7fafc;--card:#ffffff;--text:#111827;--sub:#6b7280;--accent:#0ea5e9;--muted:#e5e7eb;}
    *{box-sizing:border-box}
body {
  margin: 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
  background: url('https://images.unsplash.com/photo-1502877338535-766e1452684a') no-repeat center center fixed;
  background-size: cover;
  color: var(--text);
}

.container {
  background-color: rgba(255, 255, 255, 0.9); /* adds white overlay for readability */
  border-radius: 16px;
  padding: 16px;
  margin: 0 auto;
  max-width: 980px;
}

    header{display:flex;align-items:center;justify-content:space-between;margin:8px 0 16px}
    h1{font-size:20px;margin:0}
    .sub{color:var(--sub);font-size:12px}
    .card{background:var(--card);border:1px solid var(--muted);border-radius:16px;box-shadow:0 1px 2px rgba(0,0,0,0.04);margin-bottom:12px}
    .card h2{font-size:14px;margin:0;padding:12px 16px;border-bottom:1px solid var(--muted)}
    .content{padding:12px 16px}
    label{font-size:12px;color:var(--sub);display:block;margin-bottom:6px}
    input,select,textarea,button{font:inherit}
    input,select,textarea{width:100%;border:1px solid var(--muted);border-radius:12px;padding:8px 10px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap}
    button{border:1px solid var(--muted);background:#fff;padding:8px 12px;border-radius:12px;cursor:pointer}
    .primary{background:var(--accent);color:#fff;border-color:var(--accent)}
    .hidden{display:none}
    .small{font-size:12px;color:var(--sub)}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Daily Customer Recap</h1>
        <div class="sub">Step 1: Pick date, terminal, customer, and category. Step 2: Fill details for that category. Step 3: Submit.</div>
      </div>
      <div class="toolbar">
        <button id="btnExport">Export CSV</button>
        <button id="btnClear">Clear Form</button>
      </div>
    </header>

    <!-- PAGE 1: Basics -->
    <section class="card" id="page1">
      <h2>1) Basics</h2>
      <div class="content">
        <div class="row2">
          <div>
            <label for="date">Date</label>
            <input type="date" id="date" required />
          </div>
          <div>
            <label for="terminal">Terminal</label>
            <select id="terminal" required>
              <option value="">Select…</option>
              <option>ABILEN</option><option>ALBUQU</option><option>AMARIL</option><option>AUSTIN</option>
              <option>BROWNS</option><option>CORPUS</option><option>EDINBU</option><option>ELPASO</option>
              <option>FORTWOHOUSTO</option><option>IMPERI</option><option>LAREDO</option><option>PHOENI</option>
              <option>SANANT</option><option>SANDIE</option><option>TUCSON</option><option>VICTOR</option><option>WACO</option>
            </select>
          </div>
        </div>

        <div class="row2" style="margin-top:10px">
          <div>
            <label for="customer">Customer</label>
            <select id="customer" required>
              <option value="">Select…</option>
              <option>Associated Energy Group</option>
              <option>Avfuel Corporation</option>
              <option>AZIZ Quick Stop LLC</option>
              <option>Biourja Trading LLC</option>
              <option>Bluebonnet Petroleum Inc</option>
              <option>Boyett Petroleum</option>
              <option>Brad Hall & Associates</option>
              <option>Brookshire Brothers</option>
              <option>BW Gas & Convenience DBA Yesway</option>
              <option>Chevron U.S.A.</option>
              <option>CIRCLE K 4089</option>
              <option>Circle K Stores</option>
              <option>Citgo Petroleum Corp.</option>
              <option>Cosby Oil Company</option>
              <option>Defense Energy Support</option>
              <option>Diamond Shamrock Refining Co LP</option>
              <option>ED STAUB & SONS PETROLEUM, INC</option>
              <option>ELAN FUELS LLC</option>
              <option>Epic Aviation</option>
              <option>FAST STOP INC</option>
              <option>Flint Hills Resources</option>
              <option>Fuel Masters LLC</option>
              <option>GLOBAL PARTNERS L.P.</option>
              <option>Gold Star Petroleum, Inc.</option>
              <option>GPM Petroleum Empire Petroleum</option>
              <option>GPM Petroleum LLC</option>
              <option>HEB - Services Co. Accounting</option>
              <option>JUNCTION FUELS LLC</option>
              <option>KAG LOGISTICS 7-11</option>
              <option>KAG Logistics/Kenan Advantage</option>
              <option>KAG Logistics/Kenan Advantage AAFES</option>
              <option>Landmark Industries</option>
              <option>LB & B Associates Inc</option>
              <option>Lehigh Gas Wholesale LLC</option>
              <option>Loves Country Stores INC.</option>
              <option>Mansfield Oil Company</option>
              <option>Marathon Petroleum Company LP Supply and Trading LLC</option>
              <option>Marathon Tesoro Petroleum</option>
              <option>Marathon Tesoro Petroleum Accessorials</option>
              <option>Marathon WNR Product Transport</option>
              <option>McCraw Oil Company</option>
              <option>MERCFUEL, LLC</option>
              <option>Merrimac Energy Group</option>
              <option>MGK Logistics LLC</option>
              <option>Murphy USA</option>
              <option>NEVADA FUEL DISTRIBUTORS LLC</option>
              <option>New Distributing Company, Inc.</option>
              <option>NEW MEXICO COMPANY OPERATIONS LLC</option>
              <option>NGL Crude Logistics LLC</option>
              <option>NORTHSTAR PETROLEUM DISTRIBUTORS INC</option>
              <option>Octane Fuels</option>
              <option>Offen Petroleum LLC</option>
              <option>Petroleum  Traders</option>
              <option>PFT ALEXANDER, INC.</option>
              <option>Pilot Travel Centers LLC</option>
              <option>Pinnacle Petroleum</option>
              <option>Poet Ethanol Products LLC</option>
              <option>Port Isabel Logistical Offshore Terminal, Inc.</option>
              <option>Potent Petroleum LLC</option>
              <option>Pro Petroleum</option>
              <option>PSL SERVICES INC.</option>
              <option>River City Petroleum</option>
              <option>SC Fuels</option>
              <option>Senergy Petroleum</option>
              <option>SIGNATURE ENERGY</option>
              <option>SPRING PARTNERS LICENSING LLC</option>
              <option>Stroeher & Son INC.</option>
              <option>Sun Coast Resources,Inc.</option>
              <option>Sunoco LP Powertrack</option>
              <option>Sunshine Petroleum Distributors</option>
              <option>SUPREME OIL CO</option>
              <option>Supreme Oil Co.</option>
              <option>TAC Energy LLC</option>
              <option>Texas Petroleum Group, INC</option>
              <option>Tex-Con Oil Company</option>
              <option>The Jankovich Company</option>
              <option>Thomas Petroleum,LTD.</option>
              <option>Valero Bill Greehey</option>
              <option>Valero Energy Corp- Jet Fuel</option>
              <option>Valero Energy Ethanol</option>
              <option>Valero Marketing Supply Wholesale</option>
              <option>VALHALLA FUELS</option>
              <option>Victron Energy</option>
              <option>WEST DIRECT OIL LLC</option>
              <option>World Fuel Services, Inc.</option>
            </select>
          </div>
          <div>
            <label for="category">Category</label>
            <select id="category" required>
              <option value="">Select…</option>
              <option>Run-out</option>
              <option>Rolled Load</option>
              <option>Canceled Load</option>
              <option>Detention</option>
              <option>Incident</option>
              <option>Requested assistance from customer</option>
            </select>
          </div>
        </div>

        <div style="margin-top:12px">
          <button class="primary" id="next">Next →</button>
        </div>
      </div>
    </section>

    <!-- PAGE 2: Category-specific -->
    <section class="card hidden" id="page2">
      <h2 id="catTitle">2) Details</h2>
      <div class="content">
        <!-- RUN-OUT -->
        <div id="blockRunout" class="catBlock hidden" style="margin-top:10px">
          <h3>Run-out</h3>

          <!-- Location / Site (moved here, above Cause) -->
          <label for="location">Location / Site</label>
          <input id="location" placeholder="Store #, site name, or address"/>

          <!-- Cause (Required) -->
          <label for="runOutCause" style="margin-top:6px">Cause (required)</label>
          <select id="runOutCause" required>
            <option value="">Select…</option>
            <option>Dispatch error</option>
            <option>Capacity</option>
            <option>No Allocation</option>
            <option>Rack Down</option>
          </select>

          <!-- Order # (Required, numbers only) -->
          <label for="runOutOrder" style="margin-top:6px">Order # (required)</label>
          <input id="runOutOrder" type="number" inputmode="numeric" placeholder="Numbers only" required />

          <!-- Delivery Window Start (Required, military time dropdown) -->
          <label for="runOutWindowStart" style="margin-top:6px">Delivery Window Start (required)</label>
          <select id="runOutWindowStart" required></select>

          <!-- Delivery Window End (Required, military time dropdown) -->
          <label for="runOutWindowEnd" style="margin-top:6px">Delivery Window End (required)</label>
          <select id="runOutWindowEnd" required></select>

          <!-- Comments (Required) -->
          <label for="runOutComments" style="margin-top:6px">Comments (required)</label>
          <textarea id="runOutComments" rows="3" required placeholder="Add details…"></textarea>

          <!-- Upload (Optional — placeholder while local-only) -->
          <label for="runOutFiles" style="margin-top:6px">Upload any applicable detail (optional)</label>
          <input id="runOutFiles" type="file" multiple
                 accept=".pdf,.eml,.msg,.jpg,.jpeg,.png,.gif,.heic,.tif,.tiff,.bmp" />
          <div class="small">Note: files won’t be stored until we connect a backend; this is just a placeholder for now.</div>
        </div>

        <!-- Other categories (placeholders for now) -->
        <div id="blockRolled" class="catBlock hidden" style="margin-top:10px"><h3>Rolled Load</h3><div class="small">We’ll set this up next.</div></div>
        <div id="blockCanceled" class="catBlock hidden" style="margin-top:10px"><h3>Canceled Load</h3><div class="small">We’ll set this up next.</div></div>
        <div id="blockDetention" class="catBlock hidden" style="margin-top:10px"><h3>Detention</h3><div class="small">We’ll set this up next.</div></div>
        <div id="blockIncident" class="catBlock hidden" style="margin-top:10px"><h3>Incident</h3><div class="small">We’ll set this up next.</div></div>
        <div id="blockAssist" class="catBlock hidden" style="margin-top:10px"><h3>Requested assistance from customer</h3><div class="small">We’ll set this up next.</div></div>

        <div class="row2" style="margin-top:12px">
          <button id="back">← Back</button>
          <div style="text-align:right">
            <button class="primary" id="submit">Submit</button>
          </div>
        </div>
        <div class="small" id="status" style="margin-top:8px">Status: ready</div>
      </div>
    </section>

    <section class="card">
      <h2>Entries (this device cache)</h2>
      <div class="content">
        <div class="small">Local-only preview for now. We’ll wire up Excel/SharePoint/OneDrive after all pages are set.</div>
        <div id="list"></div>
      </div>
    </section>
  </div>

<script>
  // ---------- Utilities ----------
  const $ = (id)=>document.getElementById(id);
  const LS_KEY = 'dcr.items.v1';
  let items = JSON.parse(localStorage.getItem(LS_KEY)||'[]');
  function saveLocal(){ localStorage.setItem(LS_KEY, JSON.stringify(items)); }
  function showPage(id){ ['page1','page2'].forEach(p => $(p).classList.add('hidden')); $(id).classList.remove('hidden'); }

  // Military-time dropdown filler (00:00..23:30; change step to 60 for hourly)
  function fillMilitaryTimes(selectEl, stepMinutes = 30) {
    selectEl.innerHTML = '<option value="">Select…</option>';
    for (let h=0; h<24; h++){
      for (let m=0; m<60; m+=stepMinutes){
        const hh = String(h).padStart(2,'0');
        const mm = String(m).padStart(2,'0');
        const v = `${hh}:${mm}`;
        const opt = document.createElement('option');
        opt.value = v; opt.textContent = v;
        selectEl.appendChild(opt);
      }
    }
  }

  // ---------- Init ----------
  $('date').value = new Date().toISOString().slice(0,10);
  fillMilitaryTimes($('runOutWindowStart'), 30);
  fillMilitaryTimes($('runOutWindowEnd'), 30);

  $('next').onclick = ()=>{
    if(!$('date').value || !$('terminal').value || !$('customer').value || !$('category').value){
      alert('Please fill all the basics first.'); return;
    }
    $('catTitle').textContent = '2) Details — ' + $('category').value;
    ['blockRunout','blockRolled','blockCanceled','blockDetention','blockIncident','blockAssist']
      .forEach(id=> $(id).classList.add('hidden'));
    const cat = $('category').value;
    if (cat==='Run-out') $('blockRunout').classList.remove('hidden');
    if (cat==='Rolled Load') $('blockRolled').classList.remove('hidden');
    if (cat==='Canceled Load') $('blockCanceled').classList.remove('hidden');
    if (cat==='Detention') $('blockDetention').classList.remove('hidden');
    if (cat==='Incident') $('blockIncident').classList.remove('hidden');
    if (cat==='Requested assistance from customer') $('blockAssist').classList.remove('hidden');
    showPage('page2');
  };

  $('back').onclick = ()=> showPage('page1');
  $('btnClear').onclick = ()=> document.querySelector('form')?.reset();

  // ---------- Export CSV (local cache) ----------
  $('btnExport').onclick = ()=>{
    const rows = items.map(e=>[
      e.date, e.terminal, e.customer, e.category,
      e.location||'',
      e.cause||'', e.orderNumber||'',
      e.windowStart||'', e.windowEnd||'',
      e.runoutComments||''
    ]);
    const header = [
      'Date','Terminal','Customer','Category','Location',
      'Cause','Order#','WindowStart','WindowEnd','Comments'
    ];
    const csv = [header, ...rows].map(r=>r.map(x=>{
      const s = String(x ?? '');
      return s.includes(',') ? `"${s.replace(/"/g,'""')}"` : s;
    }).join(',')).join('\n');
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download='daily_customer_recap.csv';
    document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
  };

  // ---------- Render list ----------
  function renderList(){
    const list = $('list'); list.innerHTML='';
    if (!items.length){ list.innerHTML = '<div class="small">No entries yet.</div>'; return; }
    items.slice().reverse().forEach(e=>{
      const div = document.createElement('div');
      div.className='small'; div.style.borderBottom='1px solid #e5e7eb'; div.style.padding='6px 0';
      div.textContent = `[${e.date}] ${e.terminal} — ${e.customer} — ${e.category}`;
      list.appendChild(div);
    });
  }

  // ---------- Submit (local-only) ----------
  $('submit').onclick = ()=>{
    const base = {
      date: $('date').value,
      terminal: $('terminal').value,
      customer: $('customer').value,
      category: $('category').value
    };
    const extra = {};

    // RUN-OUT validations + mapping
    if (base.category === 'Run-out') {
      const location = $('location').value;
      const cause    = $('runOutCause').value;
      const orderNum = $('runOutOrder').value;
      const winStart = $('runOutWindowStart').value;
      const winEnd   = $('runOutWindowEnd').value;
      const comments = $('runOutComments').value.trim();

      if (!cause)    return alert('Please select a Cause.');
      if (!orderNum) return alert('Please enter Order # (numbers only).');
      if (!winStart) return alert('Please select Delivery Window Start.');
      if (!winEnd)   return alert('Please select Delivery Window End.');
      if (!comments) return alert('Please enter Comments.');

      extra.location       = location || '';
      extra.cause          = cause;
      extra.orderNumber    = orderNum;
      extra.windowStart    = winStart;
      extra.windowEnd      = winEnd;
      extra.runoutComments = comments;

      // File input present but ignored while local-only (to be wired up later)
    }

    const payload = Object.assign(
      { id: (crypto.randomUUID? crypto.randomUUID(): String(Date.now())), at: new Date().toISOString() },
      base, extra
    );

    items.push(payload); saveLocal(); renderList();
    $('status').textContent = 'Status: saved locally';

    // Clear Run-out fields (keep Basics for speed)
    $('location').value = '';
    $('runOutCause').value = '';
    $('runOutOrder').value = '';
    $('runOutWindowStart').value = '';
    $('runOutWindowEnd').value = '';
    $('runOutComments').value = '';
    if ($('runOutFiles')) $('runOutFiles').value = '';

    showPage('page1');
  };

  renderList();
</script>
</body>
</html>
